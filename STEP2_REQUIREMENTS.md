# Шаг 2. Требования: CSVReader + ArrowRecordBatchBuilder

## 2.1. Требования к CSVReader
- Поддержка чтения CSV-файлов с заголовком и без.
- Корректная обработка:
  - Разделителей (по умолчанию `,`, опционально `;`/`\t`)
  - Кавычек, экранирования, пустых строк
  - Пропуска BOM/пустых строк в начале файла
- Поддержка больших файлов (batch-обработка, не грузить всё в память)
- Корректная обработка пустых значений (nullable)
- Проверка соответствия количества столбцов заголовку
- Явное возвращение ошибок (ошибка формата, несовпадение количества столбцов, неожиданный EOF и др.)

## 2.2. Требования к ArrowRecordBatchBuilder
- Преобразование batch-строк CSV в RecordBatch Arrow согласно схеме
- Корректная обработка типов (int, float, bool, string, date, timestamp, decimal, bytes)
- Nullable: поддержка пустых значений, правильное заполнение validity bitmap
- Валидация значений (ошибка при невозможности преобразования)
- Эффективная работа с памятью (batch-size настраиваемый)
- Обработка edge-cases:
  - Пустые batch-и
  - Строки с неверным числом столбцов
  - Некорректные значения для типа (например, не число для int)

## 2.3. Тестовые сценарии

### Валидные сценарии
- Валидный CSV с разными поддерживаемыми типами (int, float, bool, string, date, timestamp, decimal, bytes)
- Nullable и required поля (микс, все nullable, все required)
- CSV с заголовком и без
- Batch-разбиение: batch size = 1, 2, 3, N, batch на границе файла, частичный batch в конце
- Unicode-символы, emoji, кириллица в значениях
- Строки с запятыми, кавычками, экранированием внутри значений
- Длинные строки (edge-case)
- Большие файлы (много строк, стресс-тест)
- Batch из пустых строк (в середине, в конце)
- Строки с пробелами вокруг значений
- Корректная обработка BOM (UTF-8 BOM в начале файла)
- Разные разделители (`,`, `;`, `\t`)
- Значения с экранированными кавычками

### Ошибочные сценарии
- Пустой файл
- Файл только с заголовком
- Строки с несовпадающим количеством столбцов (меньше/больше, чем в заголовке)
- Некорректный CSV-формат (например, незакрытая кавычка)
- Некорректные значения для типа (например, строка вместо int)
- Edge-cases для decimal/date/timestamp (невалидный формат, слишком большое/малое значение)
- Ошибка при чтении (например, io.ErrUnexpectedEOF, io.ErrClosedPipe)
- Batch полностью из невалидных строк
- Строки с пустыми значениями для required-полей
- Batch с mix валидных и невалидных строк
- Пропуск строк (skip empty/invalid)
- Неизвестный/неподдерживаемый разделитель
- Некорректные/неподдерживаемые escape-символы

### Edge-cases
- Все значения пустые (nullable)
- Все значения валидные (максимальный batch)
- Batch из одной строки
- Batch на границе файла (ровно batch size)
- Частичный batch в конце (меньше batch size)
- Строки с разным количеством пробелов, табуляций
- Строки с BOM и без
- Batch, где все значения одного типа (например, только int)
- Batch с mix типов
- Строки с длинными именами колонок
- Пустые batch-и (например, после фильтрации)

## Definition of Done
- Все требования и ограничения зафиксированы в STEP2_REQUIREMENTS.md
- Все тестовые сценарии реализованы (unit/integration)
- Проект собирается, тесты запускаются и покрывают edge-cases
